* Nxt-Disassem

**  Introduction

This is an incomplete parser for the NXT RXE file format.  
It will be able to generate a disassembly of the byte code present
in the file, also it contains code to parse the data structures
and split the static initalization vector into the right components.  

However all the tying together is not done yet.

***  What works

Assuming you have a rxe file like @code{test.rxe} the following 
(more or less interesting bits) works

#+BEGIN_EXAMPLE
(setf *p* (nxt-disassem:parse-nxt-rxe-file "test.rxe"))

(nxt-disassem:print-assembly *p*)
(nxt-disassem:make-call-graph *p*)

(nxt-disassem::parse-dstoc-table 
  (nxt-disassem::dstoc-table 
    (nxt-disassem::data-space *p*)))

(nxt-disassem::default-static-data (nxt-disassem::data-space *p*))
#+END_EXAMPLE


The parse-dstoc-table and default-static-data will
give lists which have the same structure and the elements correspond.
That is the entry described in parse-dstoc-table is 
initialized, if so required, from the corresponding element in default-static-data.

*** Example output

The output of the commands above is:

**** print-assembly

#+BEGIN_EXAMPLE
START OF CLUMP: 0
     ARRINIT          DESTINATION 32 NEWVAL 8 COUNT 11
     SET              DESTINATION 1 IMMEDIATE 40
     S-MOV            DESTINATION 19 SOURCE 1
     S-MOV            DESTINATION 12 SOURCE 16
     STRCAT           INSTRSIZE 8 DESTINATION 38 SOURCE (34)
     S-MOV            DESTINATION 29 SOURCE 38
     S-MOV            DESTINATION 1 SOURCE 15
     S-MOV            DESTINATION 31 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 1
     ADD              DESTINATION 31 SOURCE1 31 SOURCE2 1
     SET              DESTINATION 1 IMMEDIATE 2
     ADD              DESTINATION 28 SOURCE1 28 SOURCE2 1
     S-MOV            DESTINATION 1 SOURCE 19
     S-MOV            DESTINATION 0 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 1
     ADD              DESTINATION 1 SOURCE1 0 SOURCE2 1
     S-MOV            DESTINATION 15 SOURCE 1
     STRCAT           INSTRSIZE 8 DESTINATION 38 SOURCE (36)
     S-MOV            DESTINATION 13 SOURCE 38
     SET              DESTINATION 1 IMMEDIATE 12
     S-MOV            DESTINATION 2 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 0
     S-MOV            DESTINATION 6 SOURCE 1
     S-MOV            DESTINATION 1 SOURCE 2
     S-MOV            DESTINATION 0 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 10
     ADD              DESTINATION 1 SOURCE1 0 SOURCE2 1
     S-MOV            DESTINATION 6 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 0
     S-MOV            DESTINATION 0 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 56
     S-MOV            DESTINATION 3 SOURCE 1
     S-MOV            DESTINATION 1 SOURCE 31
     S-MOV            DESTINATION 23 SOURCE 0
     S-MOV            DESTINATION 24 SOURCE 3
     SET              DESTINATION 27 IMMEDIATE 0
     NUMTOSTRING      DESTINATION 25 SOURCE 1
     SYSCALL          SYSCALLID 13 PARMCLUSTER 20
     S-MOV            DESTINATION 1 SOURCE 21
     SET              DESTINATION 1 IMMEDIATE 0
     S-MOV            DESTINATION 0 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 48
     S-MOV            DESTINATION 3 SOURCE 1
     S-MOV            DESTINATION 1 SOURCE 19
     S-MOV            DESTINATION 23 SOURCE 0
     S-MOV            DESTINATION 24 SOURCE 3
     SET              DESTINATION 27 IMMEDIATE 0
     NUMTOSTRING      DESTINATION 25 SOURCE 1
     SYSCALL          SYSCALLID 13 PARMCLUSTER 20
     S-MOV            DESTINATION 1 SOURCE 21
     SET              DESTINATION 1 IMMEDIATE 0
     S-MOV            DESTINATION 0 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 40
     S-MOV            DESTINATION 3 SOURCE 1
     S-MOV            DESTINATION 1 SOURCE 15
     S-MOV            DESTINATION 23 SOURCE 0
     S-MOV            DESTINATION 24 SOURCE 3
     SET              DESTINATION 27 IMMEDIATE 0
     NUMTOSTRING      DESTINATION 25 SOURCE 1
     SYSCALL          SYSCALLID 13 PARMCLUSTER 20
     S-MOV            DESTINATION 1 SOURCE 21
     SET              DESTINATION 1 IMMEDIATE 0
     S-MOV            DESTINATION 0 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 32
     S-MOV            DESTINATION 3 SOURCE 1
     S-MOV            DESTINATION 1 SOURCE 2
     S-MOV            DESTINATION 23 SOURCE 0
     S-MOV            DESTINATION 24 SOURCE 3
     SET              DESTINATION 27 IMMEDIATE 0
     NUMTOSTRING      DESTINATION 25 SOURCE 1
     SYSCALL          SYSCALLID 13 PARMCLUSTER 20
     S-MOV            DESTINATION 1 SOURCE 21
     SET              DESTINATION 1 IMMEDIATE 0
     S-MOV            DESTINATION 0 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 24
     S-MOV            DESTINATION 3 SOURCE 1
     S-MOV            DESTINATION 1 SOURCE 6
     S-MOV            DESTINATION 23 SOURCE 0
     S-MOV            DESTINATION 24 SOURCE 3
     SET              DESTINATION 27 IMMEDIATE 0
     NUMTOSTRING      DESTINATION 25 SOURCE 1
     SYSCALL          SYSCALLID 13 PARMCLUSTER 20
     S-MOV            DESTINATION 1 SOURCE 21
     SET              DESTINATION 1 IMMEDIATE 0
     S-MOV            DESTINATION 0 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 16
     S-MOV            DESTINATION 3 SOURCE 1
     STRCAT           INSTRSIZE 8 DESTINATION 38 SOURCE (13)
     S-MOV            DESTINATION 23 SOURCE 0
     S-MOV            DESTINATION 24 SOURCE 3
     SET              DESTINATION 27 IMMEDIATE 0
     S-MOV            DESTINATION 25 SOURCE 38
     SYSCALL          SYSCALLID 13 PARMCLUSTER 20
     S-MOV            DESTINATION 1 SOURCE 21
     SET              DESTINATION 1 IMMEDIATE 0
     S-MOV            DESTINATION 0 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 8
     S-MOV            DESTINATION 3 SOURCE 1
     STRCAT           INSTRSIZE 8 DESTINATION 38 SOURCE (29)
     S-MOV            DESTINATION 23 SOURCE 0
     S-MOV            DESTINATION 24 SOURCE 3
     SET              DESTINATION 27 IMMEDIATE 0
     S-MOV            DESTINATION 25 SOURCE 38
     SYSCALL          SYSCALLID 13 PARMCLUSTER 20
     S-MOV            DESTINATION 1 SOURCE 21
     SET              DESTINATION 1 IMMEDIATE 2
     SUB              DESTINATION 28 SOURCE1 28 SOURCE2 1
     SET              DESTINATION 1 IMMEDIATE 0
     S-MOV            DESTINATION 0 SOURCE 1
     SET              DESTINATION 1 IMMEDIATE 0
     S-MOV            DESTINATION 3 SOURCE 1
     STRCAT           INSTRSIZE 8 DESTINATION 38 SOURCE (29)
     S-MOV            DESTINATION 23 SOURCE 0
     S-MOV            DESTINATION 24 SOURCE 3
     SET              DESTINATION 27 IMMEDIATE 0
     S-MOV            DESTINATION 25 SOURCE 38
     SYSCALL          SYSCALLID 13 PARMCLUSTER 20
     S-MOV            DESTINATION 1 SOURCE 21
     SET              DESTINATION 1 IMMEDIATE 10000
     S-MOV            DESTINATION 7 SOURCE 1
     S-SUBCALL        SUBROUTINE 1 CALLERID 9
     FINCLUMP         START -1 END -1

START OF CLUMP: 1
     GETTICK          DESTINATION 4
     ADD              DESTINATION 5 SOURCE1 4 SOURCE2 7
L01:
     GETTICK          DESTINATION 4
     (BRCMP <)        TARGET L01 OFFSET -2 SOURCE1 4 SOURCE2 5
     SUBRET           CALLERID 9
#+END_EXAMPLE

**** parse-dstoc-table

#+BEGIN_EXAMPLE
(#<NXT-DISASSEM::DSTOC-ENTRY :TC-SLONG :INITIALIZE-WITH-ZERO 0 {1007A846A1}>
 #<NXT-DISASSEM::DSTOC-ENTRY :TC-SLONG :INITIALIZE-WITH-ZERO 4 {1007A846C1}>
 #<NXT-DISASSEM::DSTOC-ENTRY :TC-ULONG :INITIALIZE-WITH-ZERO 8 {1007A846E1}>
 #<NXT-DISASSEM::DSTOC-ENTRY :TC-SLONG :INITIALIZE-WITH-ZERO 12 {1007A84701}>
 #<NXT-DISASSEM::DSTOC-ENTRY :TC-ULONG :INITIALIZE-WITH-ZERO 16 {1007A84721}>
 #<NXT-DISASSEM::DSTOC-ENTRY :TC-ULONG :INITIALIZE-WITH-ZERO 20 {1007A84741}>
 #<NXT-DISASSEM::DSTOC-ENTRY :TC-SWORD :INITIALIZE-WITH-ZERO 24 {1007A84761}>
 #<NXT-DISASSEM::DSTOC-ENTRY :TC-UWORD :INITIALIZE-WITH-ZERO 26 {1007A84781}>
 #<NXT-DISASSEM::DSTOC-ENTRY :TC-SBYTE :INITIALIZE-WITH-ZERO 28 {1007A847A1}>
 #<NXT-DISASSEM::DSTOC-ENTRY :TC-UBYTE :INITIALIZE-WITH-ZERO 29 {1007A847C1}>
 #<NXT-DISASSEM::DSTOC-ENTRY :TC-UBYTE :INITIALIZE-WITH-ZERO 30 {1007A847E1}>
 #<NXT-DISASSEM::DSTOC-ENTRY :TC-SBYTE :INITIALIZE-FROM-FILE 31 {1007A84801}>
 (#<NXT-DISASSEM::DSTOC-ENTRY :TC-CLUSTER :INITIALIZE-FROM-FILE 2 {1007A84821}>
  (#<NXT-DISASSEM::DSTOC-ENTRY :TC-ARRAY :INITIALIZE-FROM-FILE 32 {1007A84841}>
   #<NXT-DISASSEM::DSTOC-ENTRY :TC-UBYTE :INITIALIZE-WITH-ZERO 0 {1007A84861}>)
  #<NXT-DISASSEM::DSTOC-ENTRY :TC-UWORD :INITIALIZE-WITH-ZERO 34 {1007A84881}>)
 (#<NXT-DISASSEM::DSTOC-ENTRY :TC-CLUSTER :INITIALIZE-FROM-FILE 2 {1007A848A1}>
  (#<NXT-DISASSEM::DSTOC-ENTRY :TC-ARRAY :INITIALIZE-FROM-FILE 36 {1007A848C1}>
   #<NXT-DISASSEM::DSTOC-ENTRY :TC-UBYTE :INITIALIZE-WITH-ZERO 0 {1007A848E1}>)
  #<NXT-DISASSEM::DSTOC-ENTRY :TC-UWORD :INITIALIZE-WITH-ZERO 38 {1007A84901}>)
 (#<NXT-DISASSEM::DSTOC-ENTRY :TC-CLUSTER :INITIALIZE-FROM-FILE 4 {1007A84921}>
  #<NXT-DISASSEM::DSTOC-ENTRY :TC-SBYTE :INITIALIZE-WITH-ZERO 40 {1007A84941}>
  (#<NXT-DISASSEM::DSTOC-ENTRY :TC-CLUSTER :INITIALIZE-FROM-FILE 2
     {1007A84961}>
   #<NXT-DISASSEM::DSTOC-ENTRY :TC-SWORD :INITIALIZE-WITH-ZERO 44 {1007A84981}>
   #<NXT-DISASSEM::DSTOC-ENTRY :TC-SWORD :INITIALIZE-WITH-ZERO 46
     {1007A849A1}>)
  (#<NXT-DISASSEM::DSTOC-ENTRY :TC-ARRAY :INITIALIZE-FROM-FILE 48 {1007A849C1}>
   #<NXT-DISASSEM::DSTOC-ENTRY :TC-UBYTE :INITIALIZE-WITH-ZERO 0 {1007A849E1}>)
  #<NXT-DISASSEM::DSTOC-ENTRY :TC-ULONG :INITIALIZE-WITH-ZERO 52 {1007A84A01}>)
 (#<NXT-DISASSEM::DSTOC-ENTRY :TC-CLUSTER :INITIALIZE-FROM-FILE 2 {1007A84A21}>
  (#<NXT-DISASSEM::DSTOC-ENTRY :TC-ARRAY :INITIALIZE-FROM-FILE 56 {1007A84A41}>
   #<NXT-DISASSEM::DSTOC-ENTRY :TC-UBYTE :INITIALIZE-WITH-ZERO 0 {1007A84A61}>)
  #<NXT-DISASSEM::DSTOC-ENTRY :TC-SWORD :INITIALIZE-WITH-ZERO 58 {1007A84A81}>)
 (#<NXT-DISASSEM::DSTOC-ENTRY :TC-ARRAY :INITIALIZE-FROM-FILE 60 {1007A84AA1}>
  #<NXT-DISASSEM::DSTOC-ENTRY :TC-SLONG :INITIALIZE-FROM-FILE 0 {1007A84AC1}>)
 (#<NXT-DISASSEM::DSTOC-ENTRY :TC-ARRAY :INITIALIZE-FROM-FILE 62 {1007A84AE1}>
  #<NXT-DISASSEM::DSTOC-ENTRY :TC-UBYTE :INITIALIZE-WITH-ZERO 0 {1007A84B01}>)
 (#<NXT-DISASSEM::DSTOC-ENTRY :TC-ARRAY :INITIALIZE-FROM-FILE 64 {1007A84B21}>
  #<NXT-DISASSEM::DSTOC-ENTRY :TC-UBYTE :INITIALIZE-WITH-ZERO 0 {1007A84B41}>)
 (#<NXT-DISASSEM::DSTOC-ENTRY :TC-ARRAY :INITIALIZE-FROM-FILE 66 {1007A84B61}>
  #<NXT-DISASSEM::DSTOC-ENTRY :TC-UBYTE :INITIALIZE-FROM-FILE 0 {1007A84B81}>))
#+END_EXAMPLE

**** default-static-data

#+BEGIN_EXAMPLE
(NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL NIL 16 (1 NIL) (2 NIL)
 (NIL (NIL NIL) 3 NIL) (4 NIL) 5 6 7 8)
#+END_EXAMPLE

** License

This code is licensed under GLP v3 or later.
However if you have a concrete need for a different license,
I am open to dual license it.  

